<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Snooker Game for desktop browsers.</title>

	<link rel="stylesheet" href="styles/default.css" type="text/css" />
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-5140088-24', 'snooker.pc.pl');
        ga('send', 'pageview');
    </script>
</head>
<body>
	<script type="text/javascript" src="scripts/lib/underscore/underscore.js"></script>
	<script type="text/javascript" src="scripts/lib/events/events.js"></script>

    <script type="text/javascript" src="scripts/Game.js"></script>
	<script type="text/javascript" src="scripts/core/game/Table.js"></script>
	<script type="text/javascript" src="scripts/core/game/Ball.js"></script>
	<script type="text/javascript" src="scripts/core/game/PowerBar.js"></script>
	<script type="text/javascript" src="scripts/core/game/Cue.js"></script>
    <script type="text/javascript" src="scripts/core/game/Snooker.js"></script>
	<script type="text/javascript" src="scripts/core/models/Collision.js"></script>
	<script type="text/javascript" src="scripts/core/models/ResourceLoader.js"></script>
	<script type="text/javascript" src="scripts/core/models/KeyHandler.js"></script>
    <script type="text/javascript" src="scripts/core/models/ScaleHelper.js"></script>
    <script>
        (function (global) {
            'use strict';

            // imports
            var snooker = global.snooker;
            var KeyHandler = global.KeyHandler;

            var stopEvent = function (e) {
                if (!e) {
                    return;
                }
                if (_.isFunction(e.preventDefault)) {
                    e.preventDefault();
                }
                if (_.isFunction(e.stopPropagation)) {
                    e.stopPropagation();
                }
            };

            function bootstrap() {
                var game = global.game = new Game();

                game.initialize.call(game, function () {
                    snooker.drawTable();
                    snooker.drawBalls();
                    // snooker.drawCues();

                    (function (can) {
                        var interval;

                        function startAction(e) {
                            clearInterval(interval);
                            interval = setInterval(startAction, 50);
                            KeyHandler.mouseDown.call(game);
                            stopEvent(e);
                        }
                        function stopAction(e) {
                            clearInterval(interval);
                            KeyHandler.mouseUp.call(game, e);
                            stopEvent(e);
                        }

                        _.each([
                            "mousedown", "touchstart", "dragstart"
                        ], function (event) {
                            Events.bind(can, event, startAction);
                        });

                        _.each([
                            "mouseup", "touchend", "touchcancel",
                            "touchleave", "touchmove", "tap",
                            "dbltap", "dragmove", "dragend"
                        ], function (event) {
                            Events.bind(can, event, stopAction);
                        });
                    }(snooker.table.canvas));
                });
            }

            Events.ready(bootstrap);
        }(this));
    </script>
</body>
</html>
